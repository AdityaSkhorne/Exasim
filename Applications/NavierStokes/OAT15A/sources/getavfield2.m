function avField = getavfield2(udg,odg,param,porder)
gam = param(1);
gam1 = gam - 1.0;
Minf = param(4);
rmin = param(5);
avr = param(6);
pmin = param(7);
avs = param(8);
% slope regulaization parameter
alpha = 1.0e3;
% regulaization parameters for the bulk viscosity
bbeta = 0.01;
bmin = 0.0;
bmax = 2.0 * (2.0 / sqrt(gam*gam - 1.0));
bkh = 1.5;
% regulaization parameters for the shear viscosity
sbeta = 0.5;
smin = 0.0;
smax = 2.0;
avfix = odg(4);
Minv0 = odg(5);
Minv1 = odg(6);
Minv2 = odg(7);
Minv3 = odg(8);
r = udg(1);
ru = udg(2);
rv = udg(3);
rE = udg(4);
rx = udg(5);
rux = udg(6);
rvx = udg(7);
ry = udg(9);
ruy = udg(10);
rvy = udg(11);
r0 = 0.3;
rreg = r0 + lmax(r-r0,alpha);
dr = atan(alpha*(r - r0))/pi + (alpha*(r - r0))/(pi*(alpha^2*(r - r0)^2 + 1)) + 1/2;
%rreg = r;
r1 = 1/rreg;
uv = ru*r1;
vv = rv*r1;
E = rE*r1;
q = 0.5*(uv*uv+vv*vv);
p = gam1*(rE-rreg*q);
p = pmin + lmax(p-pmin,alpha);
H = E+p*r1;
c_star = sqrt( (2*gam1*H) / (gam+1) );
c_star = (1 / Minf) * sqrt( (2/(gam+1)) * (1+0.5*gam1*Minf*Minf) );
ux = (rux - rx*uv)*r1;
vx = (rvx - rx*vv)*r1;
uy = (ruy - ry*uv)*r1;
vy = (rvy - ry*vv)*r1;
S_xx = 0.5 * (ux + ux);
S_xy = 0.5 * (uy + vx);
S_yx = 0.5 * (vx + uy);
S_yy = 0.5 * (vy + vy);
div_v = - (ux + vy);
vort = - (vx - uy);
DucrosRatio = div_v*div_v / (div_v*div_v + vort*vort + 1.0e-16);
ShearRatio = div_v*div_v / (div_v*div_v + S_xx*S_xx + S_xy*S_xy + S_yx*S_yx + S_yy*S_yy + 1.0e-16);
rx = rx*dr;
ry = ry*dr;
nx = rx;
ny = ry;
nNorm = sqrt(nx*nx + ny*ny + 1.0e-16);
nx = nx / nNorm;
ny = ny / nNorm;
bh = 1.0/sqrt(Minv0*nx*nx + Minv1*nx*ny + Minv2*ny*nx + Minv3*ny*ny + 1.0e-16);
% bulk viscosity
x = - (bkh*bh/ (porder)) * div_v / c_star;
x = x*DucrosRatio*ShearRatio;
f = limiting(x,bmin,bmax,alpha,bbeta);
avb = (bkh*bh/(porder)) * sqrt(uv*uv + vv*vv + c_star*c_star) * f;
avb = avb*avfix;
% artificial viscosity for continuity equation
p = gam1*(rE-rreg*q);
avd = -avr*(lmin(r-rmin,alpha)+lmin(p-pmin,alpha));
avd = avd*avfix;
% shear viscosity
x = (bh/porder)*sqrt(S_xx*S_xx + S_xy*S_xy + S_yx*S_yx + S_yy*S_yy);
f = limiting(x,smin,smax,alpha,sbeta);
f = sqrt(uv*uv + vv*vv + c_star*c_star)*f;
avs = avs*f*avfix;
avField(1) = avb;
avField(2) = avd;
avField(3) = avs;
